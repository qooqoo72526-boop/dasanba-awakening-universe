<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>éˆé­‚ç…§å¦–é¡ï½œEMOTIONAL VALUE A.I.</title>
  <link rel="stylesheet" href="universe.css" />
</head>
<body data-universe="soulmirror">
  <div class="stars" id="stars"></div>
  <div class="meteor" style="animation-delay:1.2s"></div>
  <div class="meteor" style="animation-delay:3.9s; transform: scale(.9) rotate(10deg)"></div>

  <nav class="left-dock">
    <a href="index.html" title="Home">
      <svg viewBox="0 0 24 24"><path d="M3 12l9-8 9 8M5 10v10h6V14h2v6h6V10"/></svg>
      Home
    </a>
    <a href="cosmic-post-station.html" title="å®‡å®™éƒµå±€">
      <svg viewBox="0 0 24 24"><path d="M3 6h18v12H3zM3 6l9 7 9-7"/></svg>
      Post
    </a>
  </nav>

  <header class="hero">
    <div class="title-en-1">EMOTIONAL VALUE A.I.</div>
    <div class="title-en-2">AWAKENING UNIVERSE</div>
    <div class="subtitle">- å¤§ä¸‰å·´è¦ºé†’å®‡å®™ï½œé˜¿é‡‘ãƒ»ç±³æœãƒ»æ»¾æ»¾çš„é³¥æ˜Ÿçƒç”Ÿæ´»<span class="earth">ğŸŒ</span></div>
  </header>

  <main class="glass">
    <div class="hint">åœ¨é€™é¢éŠ€ç´«æ˜Ÿéœ§çš„é¡å‰ï¼Œèª å¯¦å›ç­”æ¯ä¸€é¡Œã€‚<b>ä¸è¦è¨å¥½ã€ä¸è¦æ¼”ã€‚</b>åªå°é½Šç•¶ä¸‹çš„çœŸå¯¦ã€‚</div>
    <form id="mirrorForm" class="q-list" autocomplete="off"></form>
    <div class="bar">
      <button type="button" class="line-btn" id="submitBtn" title="é€å‡ºè§£æ">
        <svg viewBox="0 0 24 24"><path d="M3 12h14M13 6l7 6-7 6"/></svg>é€å‡ºè§£æ
      </button>
    </div>
  </main>

  <section class="result" id="result">
    <div class="loading" id="loading">æ­£åœ¨å‡èšæ˜Ÿå¡µè¨Šè™Ÿâ€¦</div>
    <div class="deep" id="deep"></div>
    <div class="ll">
      <div class="avatar"><img src="assets/icon_ajin.png" alt="Ajin"></div>
      <div class="say"><div class="tag">ğŸ’› é˜¿é‡‘ AJIN</div><div id="line_ajin">â€¦</div></div>
    </div>
    <div class="ll">
      <div class="avatar"><img src="assets/icon_migou.png" alt="Migou"></div>
      <div class="say"><div class="tag">ğŸ§¡ ç±³æœ MIGOU</div><div id="line_migou">â€¦</div></div>
    </div>
    <div class="ll">
      <div class="avatar"><img src="assets/icon_gungun.png" alt="Gungun"></div>
      <div class="say"><div class="tag">ğŸ’™ æ»¾æ»¾ GUNGUN</div><div id="line_gungun">â€¦</div></div>
    </div>
  </section>

  <script src="main.js"></script>
  <script>
    const BANK = [
      {"q":"ä½ å°ã€æˆåŠŸã€çš„ç§æˆ¿å®šç¾©ï¼Ÿ","a":["åšè‡ªå·±é‚„è¢«ä¸–ç•Œéœ€è¦","è²¡å¯Œä¸æ›éˆé­‚","è‡ªç”±æ¯”æŒè²é‡è¦","å›ä¸å»ä½åƒ¹å€¼çš„è‡ªå·±"]},
      {"q":"ä½ æ€éº¼çœ‹ã€å’Œè§£ã€ï¼Ÿ","a":["å…ˆå’Œè‡ªå·±","ç†è§£ä¸æ˜¯åŸè«’","ç•Œç·šæ¯”æ“æŠ±é‡è¦","é‡ç”Ÿï¼Œä¸æ˜¯ä¿®å¾©"]},
      {"q":"ä½ ç¾åœ¨æœ€æƒ³å¤§è²èªªçš„ä¸€å¥è©±ï¼Ÿ","a":["æˆ‘å¾ˆå€¼éŒ¢ï¼Œä¸è¦ç³Ÿè¹‹æˆ‘","ä½ ä¸å¿…ç†è§£æˆ‘","è«‹å°Šé‡æˆ‘çš„æ²‰é»˜","æˆ‘é¸æ“‡æˆ‘"]},
      {"q":"ä½ çš„ã€é©•å‚²ã€æ„å‘³è‘—ï¼Ÿ","a":["è‡ªæ„›çš„é‚Šç•Œ","å®‰éœçš„å°Šåš´","å°è‡ªæˆ‘åƒ¹å€¼çš„è² è²¬","æˆ‘ä¸ä½é ­ï¼Œä½†æˆ‘èƒ½å½è…°"]},
      {"q":"ç•¶ç•Œç·šè¢«æŒ‘æˆ°ï¼Œä½ æœƒï¼Ÿ","a":["å…ˆæé†’ä¸€æ¬¡","æ›æ›´æ˜ç¢ºçš„èªªæ³•","ç›´æ¥æŠ½é›¢é—œä¿‚","åˆ—åº•ç·šæ¢æ¬¾ï¼Œèªªç ´æ”¤ç‰Œ"]},
      {"q":"ä½ èˆ‡ã€å­¤ç¨ã€çš„é—œä¿‚ï¼Ÿ","a":["æˆ‘éœ€è¦å®ƒ","å­¤ç¨æ˜¯æˆ‘çš„é¤Šåˆ†","äººç¾¤æ˜¯æš«ä½ï¼Œå­¤ç¨æ˜¯æœ¬å®¶","æˆ‘åœ¨å­¤ç¨è£¡é•·å‡ºåŠ›é‡"]}
    ];
    const form = document.getElementById('mirrorForm');
    const pick = (arr, n) => { const a=[...arr], out=[]; while(out.length<n && a.length) out.push(a.splice(Math.floor(Math.random()*a.length),1)[0]); return out; };
    const chosen = pick(BANK, Math.min(25, BANK.length));
    chosen.forEach((item, idx)=>{
      const box = document.createElement('div'); box.className='q';
      box.innerHTML = `<h3>${idx+1}. ${item.q}</h3><div class="opts"></div>`;
      const opts = box.querySelector('.opts');
      item.a.forEach(txt=>{
        const b = document.createElement('div'); b.className='opt'; b.textContent=txt;
        b.addEventListener('click',()=>{ [...opts.children].forEach(el=>el.classList.remove('active')); b.classList.add('active'); box.dataset.answer=txt; });
        opts.appendChild(b);
      });
      form.appendChild(box);
    });

    const resultEl=document.getElementById('result'), deepEl=document.getElementById('deep'), loadingEl=document.getElementById('loading');
    async function askAI(payload){
      const res = await fetch('/api/chat', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
      const data = await res.json();
      return data.output || data.choices?.[0]?.message?.content || '';
    }
    function buildPrompt(){
      const answers=[...document.querySelectorAll('.q')].map((q,i)=>({i:i+1,q:q.querySelector('h3').textContent,a:q.dataset.answer||''}));
      return {
        messages:[
          {role:'system', content:`ä½ æ˜¯ã€Œå¤§ä¸‰å·´è¦ºé†’å®‡å®™ï½œéˆé­‚ç…§å¦–é¡ã€åˆ†æå¸«ã€‚èªæ°£ä¸å®˜æ–¹ã€æ•¢æ„›æ•¢æ¨ã€æ¸…é†’ã€æœ‰é‚Šç•Œã€‚è¼¸å‡ºï¼šå…ˆä¸€æ®µç´„600å­—æ·±åº¦è§£æï¼›å†å„çµ¦é˜¿é‡‘/ç±³æœ/æ»¾æ»¾å„ä¸€å¥ï¼ˆæœ‹å‹èªæ°£ï¼Œåªç”¨é€—è™Ÿã€å¥è™Ÿã€é©šå˜†è™Ÿã€è¡¨æƒ…ï¼‰ã€‚`},
          {role:'user', content: JSON.stringify({answers}, null, 2)}
        ]
      };
    }
    document.getElementById('submitBtn').addEventListener('click', async ()=>{
      resultEl.style.display='block'; deepEl.textContent=''; loadingEl.style.display='block';
      try{
        const text = await askAI(buildPrompt());
        const parts = text.split(/\n{2,}/).map(s=>s.trim()).filter(Boolean);
        const deep = parts[0] || text;
        const aj = parts.find(p=>/é˜¿é‡‘|AJIN/.test(p)) || 'æˆ‘ä¸ç­‰å¤©æ”¾æ™´ï¼Œæˆ‘è‡ªå·±æ€é–‹é›²ã€‚';
        const mi = parts.find(p=>/ç±³æœ|MIGOU/.test(p)) || 'æˆ‘å¾ˆå€¼éŒ¢ï¼Œæˆ‘è®“è‡ªå·±æ›´è²´ã€‚';
        const gu = parts.find(p=>/æ»¾æ»¾|GUNGUN/.test(p))|| 'æˆ‘ä¸è¿½æ±‚å®‰å…¨ï¼Œæˆ‘æˆç‚ºå®‰å…¨ã€‚';
        loadingEl.style.display='none'; deepEl.textContent = deep;
        document.getElementById('line_ajin').textContent = aj;
        document.getElementById('line_migou').textContent = mi;
        document.getElementById('line_gungun').textContent = gu;
      }catch(e){ loadingEl.textContent='é€£ç·šç•°å¸¸ï¼Œç­‰ç­‰å†è©¦'; }
    });
  </script>
</body>
</html>
