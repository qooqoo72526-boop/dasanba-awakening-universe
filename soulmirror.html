
<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ğŸª éˆé­‚ç…§å¦–é¡</title>
  <link rel="stylesheet" href="css/style.css"/>
  <style>
    .wrap{max-width:1000px;margin:36px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .q{background:var(--glass);backdrop-filter:var(--blur);border-radius:14px;padding:12px;font-size:12px}
    .go{margin:16px 0;border:none;border-radius:999px;padding:12px 16px;font-size:12px;background:linear-gradient(90deg,#c6a2ff33,#93e2ff33);color:var(--fg)}
    .result{margin-top:20px}
    .ring{width:220px;height:220px;border-radius:50%;margin:10px auto;background:conic-gradient(#ffd27a 0 40%, #ff9ad0 40% 70%, #9ed8ff 70% 100%);filter:drop-shadow(0 0 20px rgba(255,255,255,.2))}
    .z{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .voice{font-size:12px;background:var(--glass);padding:10px;border-radius:12px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} .z{grid-template-columns:1fr} }
  </style>
</head>
<body class="stars">
  <div class="bg"></div>
  <div class="topbar">
    <div class="brand">SOUL MIRROR</div>
    <nav class="nav">
      <a href="/">âŸµ è¿”å›</a>
      <a href="/dialogue">âœ‰ï¸ é›²é–“ä¿¡ä»¶</a>
    </nav>
    <div class="lang">ğŸŒ</div>
  </div>

  <div class="wrap">
    <h1 class="title">ğŸª éˆé­‚ç…§å¦–é¡</h1>
    <p class="subtitle">æŠŠéˆé­‚æ”¾ä¸Šé¡é¢ è®“æ˜Ÿé›²å‘Šè¨´ä½ æ­¤åˆ»çš„è»Œé“</p>

    <div id="qs" class="grid"></div>
    <button class="go" onclick="analyze()">æäº¤å®‡å®™å›è²</button>

    <div id="res" class="result"></div>
  </div>

  <script type="module">
    import {QUESTIONS} from './js/questions.js';
    // pick 25 distinct
    const pool = [...QUESTIONS];
    const picked = [];
    while(picked.length<25 && pool.length){
      picked.push(pool.splice(Math.floor(Math.random()*pool.length),1)[0]);
    }
    const wrap = document.getElementById('qs');
    picked.forEach((q,i)=>{
      const d = document.createElement('div'); d.className='q cloudy';
      d.innerHTML = `<div style="margin-bottom:6px;opacity:.9">${q}</div>
      <input type="text" placeholder="å¯«ä¸€å¥çœŸå¯¦çš„è©±â€¦" style="width:100%;background:transparent;border:none;outline:none;color:var(--fg);font-size:12px;padding:8px 6px;border-bottom:1px dashed rgba(255,255,255,.25)">
      <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap">
        ${['æ˜¯','ä¸æ˜¯','é‚„ä¸ç¢ºå®š','ä¸æƒ³å›ç­”'].map(v=>`<label style="font-size:11px;opacity:.9"><input type='radio' name='q${i}' value='${v}'> ${v}</label>`).join('')}
      </div>`;
      wrap.appendChild(d);
    });

    async function analyze(){
      const res = document.getElementById('res');
      res.innerHTML = `<div class='ring'></div><div class='subtitle' style='text-align:center'>å®‡å®™æ­£åœ¨æ•´ç†ä½ çš„è»Œé“â€¦</div>`;
      try{
        const r = await fetch('/api/chat',{
          method:'POST',headers:{'Content-Type':'application/json'},
          body: JSON.stringify({persona:'MIGOU', message:'è«‹ä»¥600å­—æ·±å±¤ã€ä¸å®˜è…”ã€æ•¢æ„›æ•¢æ¨çš„èªæ°£ï¼Œçµ¦å‡ºæ­¤åˆ»çš„è¦ºé†’è§£æï¼Œæœ€å¾Œè®“é˜¿é‡‘ã€ç±³æœã€æ»¾æ»¾å„èªªä¸€å¥çŸ­å¥ã€‚'})
        });
        const j = await r.json();
        res.innerHTML = `
          <div class='ring'></div>
          <div class='z'>
            <div class='voice cloudy'>
              <small style="opacity:.75">è¦ºé†’è§£æ</small>
              <div style="margin-top:6px;white-space:pre-wrap">${j.reply || 'é›²å±¤å¤ªåšï¼Œç­‰ç­‰å†è©¦è©¦ã€‚'}</div>
            </div>
            <div class='voice cloudy'>
              <small style="opacity:.75">å®‡å®™ç•™å½±</small>
              <div style="margin-top:6px;display:flex;gap:8px;align-items:flex-end;justify-content:center">
                <img src="assets/ajin_clear.webp" alt="ajin" style="width:22%">
                <img src="assets/migou_clear.webp" alt="migou" style="width:22%">
                <img src="assets/gungun_clear.webp" alt="gungun" style="width:22%">
              </div>
            </div>
          </div>`;
      }catch(e){
        res.innerHTML = "<div class='voice'>é€£ç·šå¾®å¼±ï¼Œç¨å¾Œå†è©¦ã€‚</div>";
      }
    }
    window.analyze = analyze;
  </script>
</body>
</html>
