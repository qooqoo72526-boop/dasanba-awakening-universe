<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å®‡å®™éƒµå±€ï½œCOSMIC POST STATION</title>
  <link rel="stylesheet" href="universe.css" />
</head>
<body data-universe="cps">
  <div class="stars" id="stars"></div>
  <div class="meteor" style="animation-delay:1.3s"></div>
  <div class="meteor" style="animation-delay:4.0s; transform: scale(.92) rotate(-12deg)"></div>

  <nav class="left-dock">
    <a href="index.html" title="Home">
      <svg viewBox="0 0 24 24"><path d="M3 12l9-8 9 8M5 10v10h6V14h2v6h6V10"/></svg>
      Home
    </a>
    <a href="cosmic-post-station.html" title="å®‡å®™éƒµå±€">
      <svg viewBox="0 0 24 24"><path d="M3 6h18v12H3zM3 6l9 7 9-7"/></svg>
      Post
    </a>
    <a href="soulmirror.html" title="éˆé­‚ç…§å¦–é¡">
      <svg viewBox="0 0 24 24"><path d="M12 3a6 6 0 0 1 6 6v6a6 6 0 0 1-12 0V9a6 6 0 0 1 6-6z"/></svg>
      Mirror
    </a>
  </nav>

  <div style="width:min(1200px,92vw); margin:90px auto 40px; text-align:center">
    <div class="title-en-1">COSMIC POST STATION âœ‰ï¸</div>
    <div class="title-en-2">LINKING WITH THE UNIVERSE</div>
    <div class="subtitle"><b>Receiving signals from Ajin / Migou / Gungun</b> Â· å¬å–šå¤§ä¸‰å·´çš„æŠ•éå€ï¼ŒæŒ‰ Enter å‚³è¨Š</div>

    <div class="chat glass" style="margin-top:14px; padding:12px; border-radius:18px">
      <div id="flow" style="max-height:60vh; overflow:auto"></div>
      <div class="bar" style="display:flex; align-items:center; gap:10px; margin-top:10px">
        <input id="input" class="input" placeholder="æŠŠçœŸè©±ä¸Ÿé€²å®‡å®™â€¦" style="flex:1; padding:12px 14px; border-radius:999px; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:none; color:#eaf0ff;">
        <button id="sendBtn" class="line-btn">
          <svg viewBox="0 0 24 24"><path d="M3 12h14M13 6l7 6-7 6"/></svg>é€å‡º
        </button>
      </div>
    </div>
  </div>

  <script src="main.js"></script>
  <script>
    function add(name, avatar, text){
      const flow = document.getElementById('flow');
      const row = document.createElement('div');
      row.style.margin = '10px 0';
      row.innerHTML = `<div style="display:grid;grid-template-columns:48px 1fr;gap:10px;align-items:start">
          <div style="width:48px;height:48px;border-radius:50%;overflow:hidden;background: radial-gradient(circle at 30% 30%, #fff, #dfe8ff 60%, transparent 62%);box-shadow:0 0 0 2px rgba(255,255,255,.28), 0 0 25px rgba(180,200,255,.45)"><img src="${avatar}" style="width:100%;height:100%;object-fit:cover"></div>
          <div style="padding:10px 12px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));box-shadow: inset 0 0 0 1px rgba(255,255,255,.08), 0 10px 30px rgba(90,110,230,.16);font-size:14px;line-height:1.7"><b>${name}ï¼š</b>${text}</div>
        </div>`;
      flow.appendChild(row); flow.scrollTop = flow.scrollHeight;
    }
    const order = ['Ajin','Migou','Gungun'];
    const icons = {
      Ajin: 'assets/icon_ajin.png',
      Migou:'assets/icon_migou.png',
      Gungun:'assets/icon_gungun.png'
    };
    const names = { Ajin: 'ğŸ’›é˜¿é‡‘', Migou:'ğŸ§¡ç±³æœ', Gungun:'ğŸ’™æ»¾æ»¾' };

    async function askAll(msg){
      const buddies = [...order];
      if(Math.random()<.33){ buddies.unshift(buddies.pop()); }
      for(const who of buddies){
        const res = await fetch('/api/chat', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({
            messages:[
              {role:'system', content:`ä½ æ˜¯${who}ï¼Œç”¨æœ‹å‹èªæ°£èŠå¤©ã€‚ç¦æ­¢å®˜è…”ã€‚åªç”¨é€—è™Ÿã€å¥è™Ÿã€é©šå˜†è™Ÿèˆ‡è¡¨æƒ…ã€‚é˜¿é‡‘=è¡Œå‹•å¬å–šï¼›ç±³æœ=ä¸»æ¬Šèˆ‡é«˜åƒ¹å€¼ï¼ˆé«˜å‚²ä¸è¨å¥½ï¼‰ï¼›æ»¾æ»¾=è¢«ç†è§£ã€éœé»˜åŠ›é‡ã€‚`},
              {role:'user', content: msg}
            ]
          })
        });
        const data = await res.json();
        const text = (data.output || data.choices?.[0]?.message?.content || '...').trim();
        add(names[who], icons[who], text);
        await new Promise(r=>setTimeout(r, 400));
      }
    }
    const input = document.getElementById('input');
    const btn = document.getElementById('sendBtn');
    function send(){
      const v = input.value.trim(); if(!v) return;
      add('ä½ ', 'assets/icon_you.png', v);
      input.value=''; askAll(v);
    }
    btn.addEventListener('click', send);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); send(); } });
  </script>
</body>
</html>
